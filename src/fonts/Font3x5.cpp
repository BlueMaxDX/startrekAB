#include <Arduino.h>
#include <Sprites.h>
#include <Print.h>
#include "Font3x5.h"

#define FONT3X5_WIDTH 3
#define FONT3X5_HEIGHT 6

const uint8_t PROGMEM font_images[] = {
3, 8,

0x00, 0x00, 0x00,
0x00, 0x17, 0x00,
0x03, 0x00, 0x03,
0x1F, 0x0A, 0x1F,
0x06, 0x1B, 0x0C,
0x09, 0x04, 0x12,
0x0A, 0x15, 0x1A,
0x00, 0x03, 0x00,
0x00, 0x0E, 0x11,
0x11, 0x0E, 0x00,
0x15, 0x0E, 0x15,
0x04, 0x0E, 0x04,
0x10, 0x08, 0x00,
0x04, 0x04, 0x04,
0x00, 0x10, 0x00,
0x08, 0x04, 0x02,

0x1F, 0x11, 0x1F, // 0  
0x00, 0x1F, 0x00,
0x1D, 0x15, 0x17,
0x11, 0x15, 0x1F,
0x07, 0x04, 0x1F,
0x17, 0x15, 0x1D,
0x1F, 0x15, 0x1D,
0x01, 0x01, 0x1F,
0x1F, 0x15, 0x1F,
0x17, 0x15, 0x1F, // 9

0x00, 0x0A, 0x00,
0x10, 0x0A, 0x00,
0x04, 0x0A, 0x11,
0x0A, 0x0A, 0x0A,
0x11, 0x0A, 0x04,
0x01, 0x15, 0x07,

0x1F, 0x11, 0x17,

0x1F, 0x05, 0x1F, // A
0x1F, 0x15, 0x1B, 
0x1F, 0x11, 0x11, 
0x1F, 0x11, 0x0E, 
0x1F, 0x15, 0x11, 
0x1F, 0x05, 0x01, 
0x1F, 0x11, 0x1D, 
0x1F, 0x04, 0x1F, 
0x00, 0x1F, 0x00, 
0x10, 0x10, 0x1F, 
0x1F, 0x04, 0x1B, 
0x1F, 0x10, 0x10, 
0x1F, 0x06, 0x1F, 
0x1F, 0x01, 0x1F, 
0x1F, 0x11, 0x1F, 
0x1F, 0x05, 0x07, 
0x1F, 0x31, 0x1F, 
0x1F, 0x05, 0x1B,  
0x17, 0x15, 0x1D,  
0x01, 0x1F, 0x01,  
0x1F, 0x10, 0x1F,  
0x0F, 0x10, 0x0F,  
0x1F, 0x0C, 0x1F,  
0x1B, 0x04, 0x1B,  
0x07, 0x1C, 0x07,  
0x19, 0x15, 0x13, // Z
};


Font3x5::Font3x5(uint8_t lineSpacing) {

  _lineHeight = lineSpacing;
  _letterSpacing = 1;

  _cursorX = _cursorY = _baseX = 0;
  _textColor = 1;

}

size_t Font3x5::write(uint8_t c) {

  if (c == '\n')      { _cursorX = _baseX; _cursorY += _lineHeight; }
  else {

    printChar(c, _cursorX, _cursorY);
    _cursorX += FONT3X5_WIDTH + _letterSpacing;

  }

  return 1;

}

void Font3x5::printChar(const char c, const int8_t x, int8_t y) {

  int8_t idx = -1;

  ++y;

  idx = c - 32;

  if (idx > -1) {
    
    if (_textColor == WHITE) {
      Sprites::drawSelfMasked(x, y, font_images, idx);
    }
    else {
      Sprites::drawErase(x, y, font_images, idx);
    }

  }

}

void Font3x5::setCursor(const int8_t x, const int8_t y) {
  _cursorX = _baseX = x;
  _cursorY = y;
}

void Font3x5::setTextColor(const uint8_t color){
  _textColor = color;
}

void Font3x5::setHeight(const uint8_t color){
  _lineHeight = color;
}
